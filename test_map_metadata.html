<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Map Metadata Integration</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #0f172a;
            color: white;
        }
        .test-section {
            background: rgba(30, 41, 59, 0.8);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }
        button {
            background: #0891b2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0e7490;
        }
        .metadata-display {
            background: rgba(15, 23, 42, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .success {
            color: #10b981;
        }
        .error {
            color: #ef4444;
        }
    </style>
</head>
<body>
    <h1>üó∫Ô∏è Map Metadata Integration Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Set Sample Metadata</h2>
        <p>This will simulate a user uploading a file with metadata and then navigating to the map page.</p>
        <button onclick="setSampleMetadata()">Set Sample Metadata</button>
        <button onclick="setDifferentSample()">Set Different Sample</button>
        <button onclick="clearMetadata()">Clear Metadata</button>
        <div id="metadata-status"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Check Current Metadata</h2>
        <p>Check what metadata is currently stored in localStorage.</p>
        <button onclick="checkCurrentMetadata()">Check Current Metadata</button>
        <div id="current-metadata"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Navigation Links</h2>
        <p>Navigate to different pages to test the integration.</p>
        <button onclick="window.open('http://localhost:3000', '_blank')">Open TaxaFormer App</button>
        <button onclick="window.location.href='http://localhost:3000'">Go to Upload Page</button>
    </div>

    <script>
        function setSampleMetadata() {
            const sampleData = {
                metadata: {
                    sampleName: "Monterey Bay Sample",
                    totalSequences: 245,
                    processingTime: "3.2s",
                    avgConfidence: 89,
                    novelSequences: 12,
                    userMetadata: {
                        sampleId: "MB-2024-001",
                        location: {
                            latitude: "36.6002",
                            longitude: "-121.8947",
                            depth: "150",
                            site: "Monterey Bay Marine Sanctuary"
                        },
                        datetime: {
                            date: "2024-12-11",
                            time: "14:30"
                        },
                        environmental: {
                            temperature: "18.5",
                            salinity: "34.2",
                            pH: "8.1",
                            dissolvedOxygen: "7.8"
                        },
                        notes: "Sample collected during high tide near kelp forest"
                    }
                },
                taxonomy_summary: [
                    { name: 'Alveolata', value: 65, color: '#22D3EE' },
                    { name: 'Chlorophyta', value: 42, color: '#10B981' },
                    { name: 'Fungi', value: 28, color: '#A78BFA' },
                    { name: 'Metazoa', value: 38, color: '#F59E0B' },
                    { name: 'Rhodophyta', value: 25, color: '#EC4899' },
                    { name: 'Unknown', value: 47, color: '#64748B' }
                ],
                sequences: [
                    { accession: 'SEQ_001', taxonomy: 'Alveolata; Dinoflagellata; Gymnodiniales; Alexandrium minutum', length: 1842, confidence: 0.94, overlap: 87, cluster: 'C1' },
                    { accession: 'SEQ_002', taxonomy: 'Chlorophyta; Chlorophyceae; Chlamydomonadales; Dunaliella salina', length: 1654, confidence: 0.89, overlap: 92, cluster: 'C2' },
                    { accession: 'SEQ_003', taxonomy: 'Metazoa; Arthropoda; Copepoda; Calanus finmarchicus', length: 1923, confidence: 0.91, overlap: 89, cluster: 'C3' },
                    { accession: 'SEQ_004', taxonomy: 'Alveolata; Dinoflagellata; Gymnodiniales; Alexandrium minutum', length: 1756, confidence: 0.88, overlap: 85, cluster: 'C1' },
                    { accession: 'SEQ_005', taxonomy: 'Chlorophyta; Chlorophyceae; Chlamydomonadales; Dunaliella salina', length: 1598, confidence: 0.92, overlap: 91, cluster: 'C2' },
                    { accession: 'SEQ_006', taxonomy: 'Fungi; Ascomycota; Saccharomycetes; Debaryomyces hansenii', length: 1445, confidence: 0.87, overlap: 83, cluster: 'C4' },
                    { accession: 'SEQ_007', taxonomy: 'Metazoa; Cnidaria; Anthozoa; Acropora cervicornis', length: 2012, confidence: 0.95, overlap: 94, cluster: 'C5' },
                    { accession: 'SEQ_008', taxonomy: 'Alveolata; Dinoflagellata; Gymnodiniales; Alexandrium minutum', length: 1687, confidence: 0.90, overlap: 88, cluster: 'C1' }
                ]
            };

            localStorage.setItem('analysisResults', JSON.stringify(sampleData));
            
            document.getElementById('metadata-status').innerHTML = `
                <div class="metadata-display success">
                    ‚úÖ Sample metadata set successfully!<br>
                    Location: ${sampleData.metadata.userMetadata.location.site}<br>
                    Coordinates: ${sampleData.metadata.userMetadata.location.latitude}, ${sampleData.metadata.userMetadata.location.longitude}<br>
                    Depth: ${sampleData.metadata.userMetadata.location.depth}m<br>
                    Temperature: ${sampleData.metadata.userMetadata.environmental.temperature}¬∞C<br>
                    pH: ${sampleData.metadata.userMetadata.environmental.pH}<br>
                    Salinity: ${sampleData.metadata.userMetadata.environmental.salinity} PSU
                </div>
            `;
        }

        function setDifferentSample() {
            const differentSample = {
                metadata: {
                    sampleName: "Great Barrier Reef Sample",
                    totalSequences: 189,
                    processingTime: "2.8s",
                    avgConfidence: 92,
                    novelSequences: 8,
                    userMetadata: {
                        sampleId: "GBR-2024-002",
                        location: {
                            latitude: "-18.2871",
                            longitude: "147.6992",
                            depth: "25",
                            site: "Great Barrier Reef Marine Park"
                        },
                        datetime: {
                            date: "2024-12-10",
                            time: "10:15"
                        },
                        environmental: {
                            temperature: "26.8",
                            salinity: "35.1",
                            pH: "8.3",
                            dissolvedOxygen: "6.2"
                        },
                        notes: "Coral reef sample collected near Heron Island"
                    }
                },
                sequences: [
                    { accession: 'SEQ_001', taxonomy: 'Cnidaria; Anthozoa; Scleractinia; Acropora cervicornis', length: 1923, confidence: 0.96, overlap: 92, cluster: 'C1' },
                    { accession: 'SEQ_002', taxonomy: 'Cnidaria; Anthozoa; Scleractinia; Acropora cervicornis', length: 1876, confidence: 0.94, overlap: 89, cluster: 'C1' },
                    { accession: 'SEQ_003', taxonomy: 'Mollusca; Gastropoda; Neogastropoda; Conus marmoreus', length: 1654, confidence: 0.91, overlap: 87, cluster: 'C2' },
                    { accession: 'SEQ_004', taxonomy: 'Chordata; Actinopterygii; Perciformes; Amphiprion ocellaris', length: 1789, confidence: 0.93, overlap: 90, cluster: 'C3' },
                    { accession: 'SEQ_005', taxonomy: 'Cnidaria; Anthozoa; Scleractinia; Pocillopora damicornis', length: 1834, confidence: 0.89, overlap: 85, cluster: 'C4' }
                ]
            };

            localStorage.setItem('analysisResults', JSON.stringify(differentSample));
            
            document.getElementById('metadata-status').innerHTML = `
                <div class="metadata-display success">
                    ‚úÖ Different sample metadata set!<br>
                    Location: ${differentSample.metadata.userMetadata.location.site}<br>
                    Coordinates: ${differentSample.metadata.userMetadata.location.latitude}, ${differentSample.metadata.userMetadata.location.longitude}<br>
                    Top Species: Acropora cervicornis (2 sequences)<br>
                    Temperature: ${differentSample.metadata.userMetadata.environmental.temperature}¬∞C
                </div>
            `;
        }

        function clearMetadata() {
            localStorage.removeItem('analysisResults');
            document.getElementById('metadata-status').innerHTML = `
                <div class="metadata-display error">
                    üóëÔ∏è Metadata cleared from localStorage
                </div>
            `;
        }

        function checkCurrentMetadata() {
            const stored = localStorage.getItem('analysisResults');
            const statusDiv = document.getElementById('current-metadata');
            
            if (stored) {
                try {
                    const data = JSON.parse(stored);
                    const userMeta = data.metadata?.userMetadata;
                    
                    if (userMeta && userMeta.location) {
                        statusDiv.innerHTML = `
                            <div class="metadata-display success">
                                ‚úÖ Metadata found in localStorage:<br>
                                <strong>Sample ID:</strong> ${userMeta.sampleId || 'N/A'}<br>
                                <strong>Location:</strong> ${userMeta.location.site || 'N/A'}<br>
                                <strong>Coordinates:</strong> ${userMeta.location.latitude}, ${userMeta.location.longitude}<br>
                                <strong>Depth:</strong> ${userMeta.location.depth}m<br>
                                <strong>Temperature:</strong> ${userMeta.environmental?.temperature || 'N/A'}¬∞C<br>
                                <strong>pH:</strong> ${userMeta.environmental?.pH || 'N/A'}<br>
                                <strong>Salinity:</strong> ${userMeta.environmental?.salinity || 'N/A'} PSU<br>
                                <strong>Collection Date:</strong> ${userMeta.datetime?.date || 'N/A'}<br>
                                <strong>Notes:</strong> ${userMeta.notes || 'N/A'}
                            </div>
                        `;
                    } else {
                        statusDiv.innerHTML = `
                            <div class="metadata-display error">
                                ‚ö†Ô∏è Analysis results found but no location metadata
                            </div>
                        `;
                    }
                } catch (error) {
                    statusDiv.innerHTML = `
                        <div class="metadata-display error">
                            ‚ùå Error parsing stored data: ${error.message}
                        </div>
                    `;
                }
            } else {
                statusDiv.innerHTML = `
                    <div class="metadata-display error">
                        ‚ùå No analysis results found in localStorage
                    </div>
                `;
            }
        }

        // Check on page load
        window.onload = function() {
            checkCurrentMetadata();
        };
    </script>
</body>
</html>